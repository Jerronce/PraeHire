<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Analysis - PraeHire</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <div class="logo">
                <h1>PraeHire<span class="ai-badge">AI</span></h1>
            </div>
            <nav class="main-nav">
                <a href="dashboard.html">Dashboard</a>
                <a href="resume.html" class="active">Resume Analysis</a>
                <a href="interview.html">Mock Interview</a>
                <button id="logoutBtn" class="btn-secondary">Logout</button>
            </nav>
        </header>

        <main class="main-content">
            <section class="upload-section">
                <h2>Upload Your Resume</h2>
                <p>Upload your resume for AI-powered analysis and personalized recommendations</p>
                
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">üìÑ</div>
                    <p>Drag & drop your resume here or click to browse</p>
                    <input type="file" id="resumeFile" accept=".pdf,.doc,.docx" hidden>
                    <button class="btn-primary" onclick="document.getElementById('resumeFile').click()">Choose File</button>
                </div>
            </section>

            <section class="analysis-section" id="analysisSection" style="display: none;">
                <h2>Resume Analysis</h2>
                <div class="analysis-card">
                    <h3>Overall Score: <span id="overallScore" class="score">--</span>/100</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="scoreFill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h3>‚úÖ Strengths</h3>
                        <ul id="strengthsList"></ul>
                    </div>
                    <div class="analysis-card">
                        <h3>‚ö†Ô∏è Areas for Improvement</h3>
                        <ul id="improvementsList"></ul>
                    </div>
                </div>

                <div class="analysis-card">
                    <h3>üéØ Recommendations</h3>
                    <div id="recommendationsText" class="recommendations-text"></div>
                </div>

                <div class="analysis-card">
                    <h3>üîç Keyword Analysis</h3>
                    <div id="keywordsContainer" class="keywords-container"></div>
                </div>
            </section>
        </main>
    </div>

    <script type="module" src="js/firebase.js"></script>
    <script type="module" src="js/main.js"></script>
    <script type="module">
        import { auth } from './js/firebase.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'login.html';
            }
        });

        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await auth.signOut();
            window.location.href = 'login.html';
        });

        // File upload handling
        const uploadZone = document.getElementById('uploadZone');
        const resumeFile = document.getElementById('resumeFile');
        const analysisSection = document.getElementById('analysisSection');

        // Drag and drop handlers
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        resumeFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        async function handleFileUpload(file) {
            // Show loading state
            uploadZone.innerHTML = '<div class="loading">Analyzing your resume...</div>';

            // Simulate AI analysis (in production, this would call Gemini API)
            setTimeout(() => {
                displayAnalysis({
                    score: 85,
                    strengths: [
                        'Strong technical skills section',
                        'Clear and concise formatting',
                        'Relevant work experience',
                        'Quantifiable achievements'
                    ],
                    improvements: [
                        'Add more action verbs',
                        'Include specific metrics for projects',
                        'Consider adding a professional summary'
                    ],
                    recommendations: 'Your resume demonstrates strong technical competencies. To further enhance it, focus on quantifying your achievements with specific metrics and outcomes. Consider tailoring your resume to specific job descriptions by highlighting relevant keywords.',
                    keywords: ['JavaScript', 'Python', 'React', 'Node.js', 'Firebase', 'Project Management', 'Agile', 'Team Leadership']
                });
            }, 2000);
        }

        function displayAnalysis(data) {
            // Show analysis section
            analysisSection.style.display = 'block';
            analysisSection.scrollIntoView({ behavior: 'smooth' });

            // Update score
            document.getElementById('overallScore').textContent = data.score;
            document.getElementById('scoreFill').style.width = data.score + '%';

            // Update strengths
            const strengthsList = document.getElementById('strengthsList');
            strengthsList.innerHTML = '';
            data.strengths.forEach(strength => {
                const li = document.createElement('li');
                li.textContent = strength;
                strengthsList.appendChild(li);
            });

            // Update improvements
            const improvementsList = document.getElementById('improvementsList');
            improvementsList.innerHTML = '';
            data.improvements.forEach(improvement => {
                const li = document.createElement('li');
                li.textContent = improvement;
                improvementsList.appendChild(li);
            });

            // Update recommendations
            document.getElementById('recommendationsText').textContent = data.recommendations;

            // Update keywords
            const keywordsContainer = document.getElementById('keywordsContainer');
            keywordsContainer.innerHTML = '';
            data.keywords.forEach(keyword => {
                const tag = document.createElement('span');
                tag.className = 'keyword-tag';
                tag.textContent = keyword;
                keywordsContainer.appendChild(tag);
            });
        }
    </script>
</body>
</html>
